# 10. Annotation types
Date: 2021-08-20

## Status
Accepted

## Context
When AMF builds a model from a content, it must justify from where each node and property came from, so the users can track and know for sure the origin of the values. This source map information is fundamental for editing features.

In a parsed API, the elements declared in the source document have their corresponding annotations (think of `LexicalInformation` or `SourceNode`) in the final model, but some elements in the AMF model are not explicitly declared. Moreover, some of this not-declared elements are fields we can easily infer from the source document (like the name of an operation) while others have no real counterpart in the source document.

## Decision
For these reasons, the decision has been made in favor of adding 3 annotation types to make every object or field traceable to where it came from, whether it was from the source document or it was generated by AMF:

- `Annotations.inferred()`
  - A field is **inferred** when the entry has been inferred but the value is real (is present in the source document)
  - Example: The name of an operation, which has no entry `name` but we can infer it from its declaration in the document
- `Annotations.virtual()`
  - An object is **virtual** when it's generated based on one or more elements in the document, but doesn't have a specific declaration
  - Does not stop model traversal because its children nodes may have sourcemaps
  - Many objects in the AMF Model are virtual containers of information present in the document
  - Examples:
    - The `Request` object in the AMF model is virtual, because you can't assign a sourcemap to it, but the elements under it (like parameters) do have a specific definition and location in the source document
- `Annotations.synthesized()`
  - A field is **synthesized** when the entry as well as the value are generated, it's not in the document
  - This field and its value have nothing that matches it on the AST, and the same is true for its children
  - Stops model traversal (won't look into value or its children)
  - You can't have a virtual value in a synthesized field, because that means that the value is not entirely made up
  - Examples:
    - `PropertyShape.MinCount` when it's set to 1 based on a `required: true`
    - Creating a default value when there is no value declared in the document

## Consequences
This decision has no immediate impact.
